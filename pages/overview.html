<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Overview</title>
  <!-- your global CSS should already define these tokens/classes -->
  <style>
    /* minimal-only helpers (safe if you already have them) */
    .attached-issues .attach-pill{display:inline-flex;align-items:center;gap:8px;padding:2px 8px;border-radius:999px;border:1px solid var(--line);background:#0f1b2f;font-size:12px}
    .attached-issues .attach-pill .btn.sm{padding:2px 6px;border-radius:8px}
    .modal.open,.modal.show{display:flex}
  </style>
</head>
<body>

<div class="spaced">
  <div class="row" style="gap:10px">
    <button class="btn green">+ Add Project</button>
    <input class="input" style="width:280px" placeholder="Search for project"/>
  </div>
  <button id="toggleDone" class="btn">Show/Hide Done</button>
</div>

<div class="kanban" style="margin-top:14px">
  <!-- In Progress -->
  <div class="col col-progress">
    <h3><span><span class="dot yellow"></span>In Progress</span><span class="pill">5</span></h3>

    <!-- Card 1 — hours budget only -->
    <div class="card" data-project="Double Falz Seamer 4×4">
      <div class="spaced">
        <a href="#" class="pname" data-open-drawer>Project: Double Falz Seamer 4×4</a>
      </div>

      <div class="row" style="gap:8px; flex-wrap:wrap; margin-bottom:8px">
        <span class="pill"><span class="i" style="color:var(--green)">✔</span> Solved 2</span>
        <span class="pill"><span class="i" style="color:var(--amber)">⧗</span> Pending 1</span>
        <span class="pill"><span class="i">#</span> Total 3</span>
      </div>

      <div class="row" style="gap:18px; align-items:flex-start">
        <!-- LEFT -->
        <div style="flex:1; min-width:280px">
          <div class="row" style="gap:8px; align-items:center; margin-top:4px"></div>

          <div class="muted" style="margin-top:10px">Hours by user</div>
          <div class="mini-bars">
            <div class="row" style="gap:8px; align-items:center">
              <span class="muted" style="width:64px">Elvijs</span>
              <div class="bar" style="width:180px"><div class="fill" style="width:90%"></div></div>
              <span class="muted">10h</span>
            </div>
            <div class="row" style="gap:8px; align-items:center; margin-top:6px">
              <span class="muted" style="width:64px">Juris</span>
              <div class="bar" style="width:180px"><div class="fill" style="width:63%"></div></div>
              <span class="muted">7h</span>
            </div>
            <div class="row" style="gap:8px; align-items:center; margin-top:6px">
              <span class="muted" style="width:64px">Anna</span>
              <div class="bar" style="width:180px"><div class="fill" style="width:27%"></div></div>
              <span class="muted">3h</span>
            </div>
          </div>
        </div>

        <!-- RIGHT — Big progress linked to budget -->
        <div style="flex:1; min-width:280px; border-left:1px solid var(--line); padding-left:18px">
          <div class="muted" style="font-size:12px">Progress (budget)</div>
          <div style="font-size:28px; font-weight:800; line-height:1; margin-top:2px">38%</div>
          <div class="bar" style="margin-top:8px">
            <div class="fill" style="width:38%"></div>
          </div>
          <div class="muted" style="text-align:right; margin-top:6px">21/55h</div>

          <div class="row" style="gap:8px; flex-wrap:wrap; margin-top:10px">
            <span class="pill red">Open 3</span>
          </div>
        </div>
      </div>

      <div class="row" style="gap:10px; margin-top:14px">
        <button class="btn" data-open-hours>Log hours</button>
        <button class="btn" data-open-issue>Open issue</button>
        <button class="btn" data-attach-issue>Attach issue</button>
      </div>

      <!-- Attached issues render here -->
      <div class="attached-issues" style="margin-top:10px">
        <div class="muted" style="margin-bottom:6px">Attached issues</div>
        <div class="row" style="gap:8px; flex-wrap:wrap" data-attached-row></div>
      </div>
    </div>

    <!-- Card 2 — hours budget only; over time + past deadline chips under progress -->
    <div class="card" data-project="XL-200 Bender">
      <div class="spaced">
        <a href="#" class="pname" data-open-drawer>Project: XL-200 Bender</a>
      </div>

      <div class="row" style="gap:8px; flex-wrap:wrap; margin-bottom:8px">
        <span class="pill"><span class="i" style="color:var(--green)">✔</span> Solved 1</span>
        <span class="pill"><span class="i" style="color:var(--amber)">⧗</span> Pending 1</span>
        <span class="pill"><span class="i">#</span> Total 2</span>
      </div>

      <div class="row" style="gap:18px; align-items:flex-start">
        <!-- LEFT -->
        <div style="flex:1; min-width:280px">
          <div class="row" style="gap:8px; align-items:center; margin-top:4px">
            <span class="muted" style="width:120px">Hours budget</span>
            <div class="bar" style="flex:1">
              <div class="fill" style="width:100%; background:var(--red)"></div>
            </div>
            <span class="muted" style="width:90px; text-align:right">58/50h</span>
          </div>

          <div class="muted" style="margin-top:10px">Hours by user</div>
          <div class="mini-bars">
            <div class="row" style="gap:8px; align-items:center">
              <span class="muted" style="width:64px">Marta</span>
              <div class="bar" style="width:180px"><div class="fill" style="width:70%"></div></div>
              <span class="muted">7h</span>
            </div>
            <div class="row" style="gap:8px; align-items:center; margin-top:6px">
              <span class="muted" style="width:64px">Juris</span>
              <div class="bar" style="width:180px"><div class="fill" style="width:39%"></div></div>
              <span class="muted">3.7h</span>
            </div>
            <div class="row" style="gap:8px; align-items:center; margin-top:6px">
              <span class="muted" style="width:64px">Elvijs</span>
              <div class="bar" style="width:180px"><div class="fill" style="width:26%"></div></div>
              <span class="muted">2.3h</span>
            </div>
          </div>
        </div>

        <!-- RIGHT -->
        <div style="flex:1; min-width:280px; border-left:1px solid var(--line); padding-left:18px">
          <div class="muted" style="font-size:12px">Progress (deadline)</div>
          <div style="font-size:28px; font-weight:800; line-height:1; margin-top:2px">116%</div>
          <div class="bar" style="margin-top:8px">
            <div class="fill" style="width:100%; background:var(--red)"></div>
          </div>
          <div class="muted" style="text-align:right; margin-top:6px">58/50h</div>

          <div class="row" style="gap:8px; flex-wrap:wrap; margin-top:10px">
            <span class="pill red">Open 2</span>
            <span class="pill red">Over time</span>
            <span class="pill red">Past deadline</span>
          </div>
        </div>
      </div>

      <div class="row" style="gap:10px; margin-top:14px">
        <button class="btn" data-open-hours>Log hours</button>
        <button class="btn" data-open-issue>Open issue</button>
        <button class="btn" data-attach-issue>Attach issue</button>
      </div>

      <div class="attached-issues" style="margin-top:10px">
        <div class="muted" style="margin-bottom:6px">Attached issues</div>
        <div class="row" style="gap:8px; flex-wrap:wrap" data-attached-row></div>
      </div>
    </div>

    <!-- Card 3 — no budget/deadline -->
    <div class="card" data-project="Conveyor Retrofit">
      <div class="spaced">
        <a href="#" class="pname" data-open-drawer>Project: Conveyor Retrofit</a>
      </div>
      <div class="row" style="gap:8px; flex-wrap:wrap; margin-bottom:8px">
        <span class="pill"><span class="i" style="color:var(--green)">✔</span> Solved 0</span>
        <span class="pill"><span class="i" style="color:var(--amber)">⧗</span> Pending 1</span>
        <span class="pill"><span class="i">#</span> Total 1</span>
      </div>

      <div class="muted" style="margin-top:2px">Hours by user</div>
      <div class="mini-bars">
        <div class="row" style="gap:8px; align-items:center">
          <span class="muted" style="width:64px">Igors</span>
          <div class="bar" style="width:180px"><div class="fill" style="width:40%"></div></div>
          <span class="muted">2.4h</span>
        </div>
        <div class="row" style="gap:8px; align-items:center; margin-top:6px">
          <span class="muted" style="width:64px">Ruta</span>
          <div class="bar" style="width:180px"><div class="fill" style="width:30%"></div></div>
          <span class="muted">1.8h</span>
        </div>
      </div>

      <div class="row" style="gap:10px; margin-top:12px">
        <button class="btn" data-open-hours>Log hours</button>
        <button class="btn" data-open-issue>Open issue</button>
        <button class="btn" data-attach-issue>Attach issue</button>
      </div>

      <div class="attached-issues" style="margin-top:10px">
        <div class="muted" style="margin-bottom:6px">Attached issues</div>
        <div class="row" style="gap:8px; flex-wrap:wrap" data-attached-row></div>
      </div>
    </div>
  </div>

  <!-- In Review -->
  <div class="col col-review">
    <h3><span><span class="dot blue"></span>In Review</span><span class="pill">3</span></h3>

    <!-- AccuSeamer — deadline only -->
    <div class="card" data-project="AccuSeamer Rev-B">
      <div class="spaced">
        <a href="#" class="pname" data-open-drawer>Project: AccuSeamer Rev-B</a>
      </div>

      <div class="row" style="gap:8px; flex-wrap:wrap; margin-bottom:8px">
        <span class="pill"><span class="i" style="color:var(--green)">✔</span> Solved 2</span>
        <span class="pill"><span class="i" style="color:var(--amber)">⧗</span> Pending 1</span>
        <span class="pill"><span class="i">#</span> Total 3</span>
      </div>

      <div class="row" style="gap:18px; align-items:flex-start">
        <!-- LEFT: engineer hours -->
        <div style="flex:1; min-width:280px">
          <div class="muted">Hours by user</div>
          <div class="mini-bars" style="margin-top:6px">
            <div class="row" style="gap:8px"><span class="muted" style="width:64px">Elvijs</span><div class="bar" style="width:180px"><div class="fill" style="width:70%"></div></div><span class="muted">12h</span></div>
            <div class="row" style="gap:8px; margin-top:6px"><span class="muted" style="width:64px">Juris</span><div class="bar" style="width:180px"><div class="fill" style="width:55%"></div></div><span class="muted">9h</span></div>
            <div class="row" style="gap:8px; margin-top:6px"><span class="muted" style="width:64px">Anna</span><div class="bar" style="width:180px"><div class="fill" style="width:45%"></div></div><span class="muted">7h</span></div>
            <div class="row" style="gap:8px; margin-top:6px"><span class="muted" style="width:64px">Igors</span><div class="bar" style="width:180px"><div class="fill" style="width:30%"></div></div><span class="muted">5h</span></div>
          </div>
        </div>

        <!-- RIGHT: big deadline progress -->
        <div style="flex:1; min-width:280px; border-left:1px solid var(--line); padding-left:18px">
          <div class="muted" style="font-size:12px">Progress (deadline)</div>
          <div style="font-size:28px; font-weight:800; line-height:1; margin-top:2px">55%</div>
          <div class="bar" style="margin-top:8px">
            <div class="fill" style="width:55%; background:#f59e0b"></div>
          </div>
          <div class="muted" style="margin-top:6px">9 days left (25 Oct)</div>

          <div class="row" style="gap:8px; flex-wrap:wrap; margin-top:10px">
            <span class="pill">Open 1</span>
          </div>
        </div>
      </div>

      <div class="row" style="gap:10px; margin-top:14px">
        <button class="btn" data-open-hours>Log hours</button>
        <button class="btn" data-open-issue>Open issue</button>
        <button class="btn" data-attach-issue>Attach issue</button>
      </div>

      <div class="attached-issues" style="margin-top:10px">
        <div class="muted" style="margin-bottom:6px">Attached issues</div>
        <div class="row" style="gap:8px; flex-wrap:wrap" data-attached-row></div>
      </div>
    </div>

    <!-- DXL-350 — deadline only (past) -->
    <div class="card" data-project="DXL-350 Docs">
      <div class="spaced">
        <a href="#" class="pname" data-open-drawer>Project: DXL-350 Docs</a>
      </div>

      <div class="row" style="gap:8px; flex-wrap:wrap; margin-bottom:8px">
        <span class="pill"><span class="i" style="color:var(--green)">✔</span> Solved 0</span>
        <span class="pill"><span class="i" style="color:var(--amber)">⧗</span> Pending 2</span>
        <span class="pill"><span class="i">#</span> Total 2</span>
      </div>

      <div class="row" style="gap:18px; align-items:flex-start">
        <!-- LEFT: engineer hours -->
        <div style="flex:1; min-width:280px">
          <div class="muted">Hours by user</div>
          <div class="mini-bars" style="margin-top:6px">
            <div class="row" style="gap:8px"><span class="muted" style="width:64px">Marta</span><div class="bar" style="width:180px"><div class="fill" style="width:44%"></div></div><span class="muted">4h</span></div>
            <div class="row" style="gap:8px; margin-top:6px"><span class="muted" style="width:64px">Ruta</span><div class="bar" style="width:180px"><div class="fill" style="width:33%"></div></div><span class="muted">3h</span></div>
          </div>
        </div>

        <!-- RIGHT -->
        <div style="flex:1; min-width:280px; border-left:1px solid var(--line); padding-left:18px">
          <div class="muted" style="font-size:12px">Progress (deadline)</div>
          <div style="font-size:28px; font-weight:800; line-height:1; margin-top:2px">100%</div>
          <div class="bar" style="margin-top:8px">
            <div class="fill" style="width:100%; background:var(--red)"></div>
          </div>
          <div class="muted" style="margin-top:6px">Past 2 days (08 Oct)</div>

          <div class="row" style="gap:8px; flex-wrap:wrap; margin-top:10px">
            <span class="pill red">Open 2</span>
            <span class="pill red">Past deadline</span>
          </div>
        </div>
      </div>

      <div class="row" style="gap:10px; margin-top:14px">
        <button class="btn" data-open-hours>Log hours</button>
        <button class="btn" data-open-issue>Open issue</button>
        <button class="btn" data-attach-issue>Attach issue</button>
      </div>

      <div class="attached-issues" style="margin-top:10px">
        <div class="muted" style="margin-bottom:6px">Attached issues</div>
        <div class="row" style="gap:8px; flex-wrap:wrap" data-attached-row></div>
      </div>
    </div>

    <!-- Alignment Jig — no budget/deadline -->
    <div class="card" data-project="Alignment Jig">
      <div class="spaced">
        <a href="#" class="pname" data-open-drawer>Project: Alignment Jig</a>
      </div>

      <div class="row" style="gap:8px; flex-wrap:wrap; margin-bottom:8px">
        <span class="pill"><span class="i" style="color:var(--green)">✔</span> Solved 1</span>
        <span class="pill"><span class="i" style="color:var(--amber)">⧗</span> Pending 0</span>
        <span class="pill"><span class="i">#</span> Total 1</span>
      </div>

      <div class="muted" style="margin-top:2px">Hours by user</div>
      <div class="mini-bars">
        <div class="row" style="gap:8px; align-items:center">
          <span class="muted" style="width:64px">Elvijs</span>
          <div class="bar" style="width:180px"><div class="fill" style="width:40%"></div></div>
          <span class="muted">2h</span>
        </div>
        <div class="row" style="gap:8px; align-items:center; margin-top:6px">
          <span class="muted" style="width:64px">Anna</span>
          <div class="bar" style="width:180px"><div class="fill" style="width:60%"></div></div>
          <span class="muted">3h</span>
        </div>
      </div>

      <div class="row" style="gap:10px; margin-top:12px">
        <button class="btn" data-open-hours>Log hours</button>
        <button class="btn" data-open-issue>Open issue</button>
        <button class="btn" data-attach-issue>Attach issue</button>
      </div>

      <div class="attached-issues" style="margin-top:10px">
        <div class="muted" style="margin-bottom:6px">Attached issues</div>
        <div class="row" style="gap:8px; flex-wrap:wrap" data-attached-row></div>
      </div>
    </div>
  </div>

  <!-- Done -->
  <div class="col col-done" id="doneCol">
    <h3><span><span class="dot green"></span>Done</span><span class="pill green">Solved 9</span></h3>

    <div class="card" data-project="XL-150 Docs">
      <div class="spaced">
        <a href="#" class="pname" data-open-drawer>Project: XL-150 Docs</a>
      </div>
      <div class="row" style="gap:8px; flex-wrap:wrap; margin-bottom:8px">
        <span class="pill"><span class="i" style="color:var(--green)">✔</span> Solved 5</span>
        <span class="pill"><span class="i" style="color:var(--amber)">⧗</span> Pending 0</span>
        <span class="pill"><span class="i">#</span> Total 5</span>
      </div>
      <div class="muted" style="margin-top:8px">Closed items archived.</div>
      <div class="row" style="gap:10px; margin-top:12px">
        <button class="btn" data-open-hours>Log hours</button>
        <button class="btn" data-open-issue>Open issue</button>
        <button class="btn" data-attach-issue>Attach issue</button>
      </div>
      <div class="attached-issues" style="margin-top:10px">
        <div class="muted" style="margin-bottom:6px">Attached issues</div>
        <div class="row" style="gap:8px; flex-wrap:wrap" data-attached-row></div>
      </div>
    </div>

    <div class="card" data-project="L-200 Bender">
      <div class="spaced">
        <a href="#" class="pname" data-open-drawer>Project: L-200 Bender</a>
      </div>
      <div class="row" style="gap:8px; flex-wrap:wrap; margin-bottom:8px">
        <span class="pill"><span class="i" style="color:var(--green)">✔</span> Solved 2</span>
        <span class="pill"><span class="i" style="color:var(--amber)">⧗</span> Pending 0</span>
        <span class="pill"><span class="i">#</span> Total 2</span>
      </div>
      <div class="muted" style="margin-top:8px">All tasks completed.</div>
      <div class="row" style="gap:10px; margin-top:12px">
        <button class="btn" data-open-hours>Log hours</button>
        <button class="btn" data-open-issue>Open issue</button>
        <button class="btn" data-attach-issue>Attach issue</button>
      </div>
      <div class="attached-issues" style="margin-top:10px">
        <div class="muted" style="margin-bottom:6px">Attached issues</div>
        <div class="row" style="gap:8px; flex-wrap:wrap" data-attached-row></div>
      </div>
    </div>

    <div class="card" data-project="Gearbox Rev-C">
      <div class="spaced">
        <a href="#" class="pname" data-open-drawer>Project: Gearbox Rev-C</a>
      </div>
      <div class="row" style="gap:8px; flex-wrap:wrap; margin-bottom:8px">
        <span class="pill"><span class="i" style="color:var(--green)">✔</span> Solved 2</span>
        <span class="pill"><span class="i" style="color:var(--amber)">⧗</span> Pending 0</span>
        <span class="pill"><span class="i">#</span> Total 2</span>
      </div>
      <div class="mini-bars">
        <div class="row" style="gap:8px"><span class="muted" style="width:64px">Marta</span><div class="bar" style="width:180px"><div class="fill" style="width:40%"></div></div><span class="muted">4h</span></div>
        <div class="row" style="gap:8px; margin-top:6px"><span class="muted" style="width:64px">Ivans</span><div class="bar" style="width:180px"><div class="fill" style="width:50%"></div></div><span class="muted">5h</span></div>
        <div class="row" style="gap:8px; margin-top:6px"><span class="muted" style="width:64px">Ruta</span><div class="bar" style="width:180px"><div class="fill" style="width:18%"></div></div><span class="muted">2h</span></div>
      </div>
      <div class="row" style="gap:10px; margin-top:12px">
        <button class="btn" data-open-hours>Log hours</button>
        <button class="btn" data-open-issue>Open issue</button>
        <button class="btn" data-attach-issue>Attach issue</button>
      </div>
      <div class="attached-issues" style="margin-top:10px">
        <div class="muted" style="margin-bottom:6px">Attached issues</div>
        <div class="row" style="gap:8px; flex-wrap:wrap" data-attached-row></div>
      </div>
    </div>
  </div>
</div>

<!-- Drawer -->
<aside class="drawer" id="drawer">
  <header>
    <strong>Project: DFS 4×4</strong>
    <button class="btn ghost" id="closeDrawer" style="color:#fff">Close</button>
  </header>
  <div class="body">
    <div class="note summary">
      <div class="header">
        <strong>Summary</strong>
        <span class="badge">Updated 10.10.2025 • 14:20</span>
      </div>

      <!-- Filter chips -->
      <div class="chips" id="summaryChips">
        <span class="chip toggle active" data-summary="supply">Supply</span>
        <span class="chip toggle active" data-summary="machining">Machining</span>
        <span class="chip toggle active" data-summary="assembly">Assembly</span>
        <span class="chip toggle active" data-summary="qa">QA feedback</span>
      </div>

      <div class="imgph">placeholder image / chart</div>

      <div class="summary-topic" data-summary="supply">
        <div class="topic-divider">Topic: Supply & Logistics</div>
        <ul>
          <li>Vendor shipped <strong>14T gears</strong> instead of <strong>16T</strong> in batch <em>G4-221</em>; 6 units short for pilot run.</li>
          <li>Correct lot dispatched via express; RMA raised for the mis-picked parts.</li>
          <li><strong>Problem solved</strong> by <strong>Ivans</strong> • 10.10.2025 — Fix: courier reroute + RMA processed.</li>
        </ul>
      </div>

      <div class="summary-topic" data-summary="machining">
        <div class="topic-divider">Topic: Machining & Finishing</div>
        <ul>
          <li>Tooth burrs found on pinion lot <em>P-88</em> after heat-treat; parts sent for tumble + light re-grind.</li>
          <li>Two carriers failed flatness (0.09 mm); refinishing planned — ETA tomorrow 11:30.</li>
          <li><strong>Problem solved</strong> by <strong>Juris</strong> • 09.10.2025 — Fix: re-grind + Ra ≤ 0.8 μm; QA sign-off.</li>
        </ul>
      </div>

      <div class="summary-topic" data-summary="assembly">
        <div class="topic-divider">Topic: Assembly & Tolerances</div>
        <ul>
          <li>Backlash out of spec on stage-2 (0.18 mm). Temporary shim OK for test but adds side-load.</li>
          <li><strong>Resolution</strong>: Shim pack v3 + spacer R2 bring stack within ±0.02 mm; retest scheduled 15:00.</li>
        </ul>
      </div>

      <div class="summary-topic" data-summary="qa">
        <div class="topic-divider">Topic: QA & Field feedback</div>
        <ul>
          <li>Field unit #A17 vibration at 3,200 RPM — <em>not reproducible</em> after shaft balance.</li>
          <li><strong>Outcome</strong>: 11.10 — <strong>Ivans</strong> marked Field unit #A17 <span style="color:#22c55e">resolved</span>; monitor A-series for 24 h.</li>
        </ul>
      </div>
    </div>

    <!-- Event history -->
    <div class="note">
      <div class="header">
        <strong>Event history</strong>
        <div class="row" style="gap:6px; flex-wrap:wrap">
          <span class="muted" style="font-size:12px">Status:</span>
          <button class="btn sm green" data-status="all">All</button>
          <button class="btn sm" data-status="open">Open</button>
          <button class="btn sm" data-status="resolved">Solved</button>
          <span class="muted" style="font-size:12px; margin-left:6px">Topics:</span>
          <span class="chip toggle active" data-topic="supply">Supply</span>
          <span class="chip toggle active" data-topic="machining">Machining</span>
          <span class="chip toggle active" data-topic="assembly">Assembly</span>
          <span class="chip toggle active" data-topic="qa">QA</span>
        </div>
      </div>

      <div class="timeline-group">
        <h4>Supply & Logistics</h4>
        <ul class="timeline">
          <li class="open" data-topic="supply">
            Issue #412 “Wrong gear pitch shipped (14T vs 16T)” — <em>Open</em>
            <span class="topic-tag">Supply</span>
            <div class="meta">Opened by Marta • 09.10.2025 09:05 • Criticality: Medium</div>
          </li>
          <li class="resolved" data-topic="supply">
            Ticket #405 “Courier delay on lot P-88” — <strong>Resolved</strong>
            <span class="topic-tag">Supply</span>
            <div class="meta">Resolved by Ivans • 08.10.2025 13:20 • How: rerouted via DHL Express; received 22:10</div>
          </li>
        </ul>
      </div>

      <div class="timeline-group">
        <h4>Machining & Finishing</h4>
        <ul class="timeline">
          <li class="resolved" data-topic="machining">
            Issue #399 “Tooth burrs on pinion lot P-88” — <strong>Resolved</strong>
            <span class="topic-tag">Machining</span>
            <div class="meta">Resolved by Juris • 09.10.2025 18:40 • How: tumble + light re-grind; Ra ≤ 0.8 μm</div>
          </li>
          <li class="open" data-topic="machining">
            NCR #401 “Carrier face flatness 0.09 mm (limit 0.05 mm)” — <em>Open</em>
            <span class="topic-tag">Machining</span>
            <div class="meta">Owner: Elvijs • 10.10.2025 10:12 • Action: resurfacing booked 11:30</div>
          </li>
        </ul>
      </div>

      <div class="timeline-group">
        <h4>Assembly & Tolerances</h4>
        <ul class="timeline">
          <li class="open" data-topic="assembly">
            Issue #374 “Stage-2 backlash over spec” — <em>Open</em>
            <span class="topic-tag">Assembly</span>
            <div class="meta">Opened by Elvijs • 09.10.2025 11:42 • Criticality: High</div>
          </li>
          <li class="resolved" data-topic="assembly">
            Issue #361 “Idler gear tooth chipping” — <strong>Resolved</strong>
            <span class="topic-tag">Assembly</span>
            <div class="meta">Resolved by Ivans • 08.10.2025 16:10 • How: replaced idler + shim pack; retest passed</div>
          </li>
        </ul>
      </div>

      <div class="timeline-group">
        <h4>QA & Field feedback</h4>
        <ul class="timeline">
          <li class="resolved" data-topic="qa">
            Issue #352 “Field unit #A17 vibration” — <strong>Resolved</strong>
            <span class="topic-tag">QA</span>
            <div class="meta">Resolved by Ivans • 11.10.2025 10:05 • How: shaft balance; 30-min burn-in OK</div>
          </li>
        </ul>
      </div>
    </div>
  </div>
</aside>

<!-- Modals -->
<div class="modal" id="hoursModal">
  <div class="panel">
    <div class="spaced"><h3>Log hours</h3><button class="btn" data-close>Close</button></div>
    <div class="row" style="gap:10px; margin-top:10px">
      <div style="flex:1"><label>User</label><input class="input" placeholder="Juris"/></div>
      <div style="flex:1"><label>Date</label><input class="input" type="date" value="2025-10-10"/></div>
      <div style="flex:1"><label>Hours</label><input class="input" type="number" min="0" step="0.5" value="3"/></div>
    </div>
    <div style="margin-top:10px"><label>Comment</label><textarea class="input" rows="3" placeholder="I upgraded assembly"></textarea></div>
    <div class="row" style="gap:8px; margin-top:12px"><button class="btn green">Save</button><button class="btn" data-close>Cancel</button></div>
  </div>
</div>

<div class="modal" id="issueModal">
  <div class="panel">
    <div class="spaced"><h3>Open issue</h3><button class="btn" data-close>Close</button></div>
    <div class="row" style="gap:10px; margin-top:10px">
      <div style="flex:2"><label>Description</label><input class="input" placeholder="Describe the problem"/></div>
      <div style="flex:1"><label>Criticality</label>
        <select class="input"><option>Low</option><option>Medium</option><option>High</option></select>
      </div>
    </div>
    <div class="row" style="gap:10px; margin-top:10px">
      <div style="flex:1"><label>Assignee (optional)</label><input class="input" placeholder="Global / pick user"/></div>
      <div style="flex:1"><label>Attachment</label><input class="input" type="file"/></div>
    </div>
    <div class="row" style="gap:8px; margin-top:12px"><button class="btn green">Create issue</button><button class="btn" data-close>Cancel</button></div>
  </div>
</div>

<!-- Attach Issue Modal -->
<div class="modal" id="attachIssueModal">
  <div class="panel">
    <div class="spaced">
      <h3>Attach issue to project</h3>
      <button class="btn" data-close-attach>Close</button>
    </div>

    <div class="muted" style="margin-top:6px">
      Showing issues with status: <strong>Open / In-progress</strong>
    </div>

    <div class="row" style="gap:10px; margin-top:10px">
      <div style="flex:1">
        <label for="attachIssueSelect">Pick an issue</label>
        <select class="input" id="attachIssueSelect"></select>
      </div>
    </div>

    <div style="margin-top:10px">
      <label>Comment (optional)</label>
      <textarea class="input" id="attachIssueNote" rows="2" placeholder="Why attach this issue?"></textarea>
    </div>

    <div class="row" style="gap:8px; margin-top:12px">
      <button class="btn green" id="attachIssueConfirm">Attach</button>
      <button class="btn" data-close-attach>Cancel</button>
    </div>
  </div>
</div>

<script>
/* === Overview-only Attach Issue (namespaced, no globals clobbered) === */
(function(){
  const STORAGE_KEY = 'attachedIssues.v1';
  const issuesCandidates = ['pages/issues.html','issues.html','/pages/issues.html'];

  function loadDB(){ try{ return JSON.parse(localStorage.getItem(STORAGE_KEY)||'{}'); }catch(e){ return {}; } }
  function saveDB(db){ localStorage.setItem(STORAGE_KEY, JSON.stringify(db)); }

  function getProjectName(card){
    return card.getAttribute('data-project') ||
      (card.querySelector('.pname')?.textContent||'').replace(/^Project:\s*/,'').trim();
  }

  function pill(text, id){
    const span = document.createElement('span');
    span.className = 'pill attach-pill';
    span.dataset.issueId = id;
    span.innerHTML = `<strong>#${id}</strong> ${text} <button class="btn sm ghost" data-detach title="Detach">×</button>`;
    return span;
  }

  function renderCardPills(card){
    const row = card.querySelector('[data-attached-row]');
    const proj = getProjectName(card);
    const list = (loadDB()[proj]||[]);
    row.innerHTML = '';
    list.forEach(i => row.appendChild(pill(i.title, i.id)));
    row.querySelectorAll('[data-detach]').forEach(btn=>{
      btn.onclick = (e)=>{
        e.preventDefault();
        const id = Number(btn.closest('.attach-pill').dataset.issueId);
        const db = loadDB();
        db[proj] = (db[proj]||[]).filter(x => x.id !== id);
        saveDB(db);
        renderCardPills(card);
      };
    });
  }

  function boot(){
    // add click handlers for buttons
    document.querySelectorAll('.card [data-attach-issue]').forEach(btn=>{
      btn.addEventListener('click', async ()=>{
        const card = btn.closest('.card');
        const proj = getProjectName(card);
        const modal = document.getElementById('attachIssueModal');
        const select = modal.querySelector('#attachIssueSelect');
        const confirm = modal.querySelector('#attachIssueConfirm');

        // open modal
        modal.classList.add('open','show');

        // fetch issues.html
        let html = '';
        for (const path of issuesCandidates){
          try {
            html = await fetch(path, {cache:'no-cache'}).then(r=> r.ok ? r.text() : '');
            if (html) break;
          } catch(e){}
        }
        if (!html){ select.innerHTML = '<option value="">Cannot load issues.html</option>'; return; }

        // parse and filter
        const doc = new DOMParser().parseFromString(html, 'text/html');
        const rows = Array.from(doc.querySelectorAll('#issuesBody tr'));
        const items = rows.map(tr=>{
          const status =
            tr.classList.contains('open') ? 'Open' :
            tr.classList.contains('progress') ? 'In progress' :
            tr.classList.contains('resolved') ? 'Resolved' :
            (tr.cells[3]?.innerText?.trim() || '');
          const id = Number(tr.getAttribute('data-id')) || Number((tr.textContent||'').match(/#(\d{2,})/)?.[1]);
          const title = tr.cells[1]?.innerText?.trim() || '';
          const project = tr.getAttribute('data-project') || tr.cells[0]?.innerText?.trim() || '';
          return {id, title, status, project};
        }).filter(i => i?.id && (i.status === 'Open' || i.status === 'In progress'));

        // exclude already attached
        const attachedIds = new Set((loadDB()[proj]||[]).map(x=>x.id));
        const opts = items.filter(i=>!attachedIds.has(i.id))
          .map(i=>`<option value="${i.id}">#${i.id} • ${i.title} — ${i.project} (${i.status})</option>`).join('');
        select.innerHTML = opts || '<option value="">No open/in-progress issues</option>';

        // attach selection
        confirm.onclick = ()=>{
          const pickId = Number(select.value);
          if (!pickId) return;
          const pick = items.find(x => x.id === pickId);
          const db = loadDB();
          db[proj] = db[proj] || [];
          if (!db[proj].some(x=>x.id===pick.id)){
            db[proj].push({id: pick.id, title: pick.title, status: pick.status});
            saveDB(db);
          }
          renderCardPills(card);
          modal.classList.remove('open','show');
        };
      });
    });

    // close modal
    document.querySelectorAll('#attachIssueModal [data-close-attach]').forEach(b=>{
      b.addEventListener('click', ()=> document.getElementById('attachIssueModal').classList.remove('open','show'));
    });
    document.getElementById('attachIssueModal').addEventListener('click', (e)=>{
      if (e.target === e.currentTarget) e.currentTarget.classList.remove('open','show');
    });

    // initial render of any saved attachments
    document.querySelectorAll('.card').forEach(renderCardPills);
  }

  if (document.readyState === 'loading') {
    document.addEventListener('DOMContentLoaded', boot);
  } else {
    boot();
  }
})();
</script>

</body>
</html>
